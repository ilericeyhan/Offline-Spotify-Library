import os
import json
import logging

class I18nService:
    """
    Handles translation and localization for the application.
    """
    _instance = None
    
    def __new__(cls):
        if cls._instance is None:
            cls._instance = super(I18nService, cls).__new__(cls)
            cls._instance._initialized = False
        return cls._instance

    def __init__(self):
        if self._initialized: return
        self.logger = logging.getLogger("spotdl_gui")
        self.lang = "en"
        self.translations = {}
        self._load_translations()
        self._initialized = True

    def _load_translations(self):
        # Default translations as fallback
        self.translations = {
            "en": {
                "library": "Library",
                "profile": "My Profile",
                "downloader": "Quick Download",
                "history": "History",
                "settings": "Settings",
                "logs": "Logs",
                "about": "About/FAQ",
                "sync": "Sync",
                "sync_all": "Sync All",
                "status": "Status",
                "tracks": "tracks",
                "last_sync": "Last Sync",
                "spotify_updated": "Spotify Updated",
                "checking": "Checking...",
                "synced": "Synced",
                "new_songs": "New Songs Available",
                "interrupted": "Interrupted",
                "new": "New",
                "details": "Details",
                "save": "Save Settings",
                "language": "Language",
                "cookie_file": "Cookie File",
                "output_path": "Download Path",
                "client_id": "Spotify Client ID",
                "client_secret": "Spotify Client Password",
                "user_id": "Default User Name",
                "log_level": "Log Level",
                "refresh_status": "Refresh",
                "import_folder": "Import Folder",
                "add_profile": "Add from Profile",
                "add_url": "Add link Manually",
                "new_group": "New Group",
                "browse": "Browse",
                "download": "Download",
                "clear_history": "Clear History",
                "no_history": "No history found.",
                "no_tracks_recorded": "No track details recorded.",
                "error": "ERROR",
                "aborted": "Aborted",
                "login": "Login with Spotify",
                "logout": "Logout",
                "refresh": "Refresh",
                "search": "Search",
                "my_playlists": "My Playlists",
                "created_by_me": "Created by Me",
                "followed_playlists": "Followed Playlists",
                "quick_download": "Quick Download",
                "url_placeholder": "Enter Spotify Track or Playlist link",
                "format": "Format",
                "ready": "Ready",
                "sync_library": "Library",
                "new_downloads_feed": "New Downloads Feed",
                "collapse": "Collapse",
                "expand": "Expand",
                "technical_logs": "Technical Debug Logs",
                "followers": "Followers",
                "not_logged_in": "Not logged in",
                "loading": "Loading...",
                "logout_confirm": "Are you sure you want to logout from Spotify?",
                "logout_success": "Logged out from Spotify successfully.",
                "liked_songs": "Liked Songs",
                "profile_required": "Profile Required",
                "authenticating": "Authenticating with Spotify...",
                "fetching_playlists": "Fetching playlists...",
                "empty_library": "Your Sync Library is Empty",
                "library_info": "This is where your tracked playlists live.",
                "quick_start": "ğŸ’¡ Quick Start:\n1. Go to the 'My Profile' tab\n2. Login with Spotify\n3. Select playlists and add to library",
                "scanning_disk": "Scanning Disk for Playlists",
                "checking_sync": "Checking Library Sync Status",
                "never": "Never",
                "empty_group": "(Empty Group)",
                "rendering": "Rendering items...",
                "refresh_metadata": "Refreshing Metadata",
                "new_group_prompt": "Enter Group Name:",
                "rename_group": "Rename Group",
                "new_name": "New Name:",
                "last_sync": "Last Sync",
                "spotify_updated_lbl": "Spotify Updated",
                "new_songs_available": "New Songs Available",
                "discovered_on_disk": "Discovered on Disk",
                "syncing": "Syncing",
                "spotipy_missing": "Spotipy Library Missing",
                "remove": "Remove",
                "remove_confirm": "Remove '{name}' from library?",
                "sync_complete": "Sync Complete",
                "download_complete": "Download Complete",
                "new": "New",
                "could_not_load_readme": "Could not load FAQ documentation.",
                "settings_saved": "Settings saved successfully!",
                "restart_notice": "Language changed. Please restart the application for full effect.",
                "restore_defaults": "Restore Defaults",
                "restore_confirm": "Are you sure you want to reset all settings?\nThis will clear API keys, paths, and logout of Spotify.",
                "reset_done": "Application settings restored to defaults.",
                "success": "Success",
                "warning": "Warnings",
                "info": "Info",
                "error_lbl": "Error",
                "confirmation": "Confirmation",
                "login_title": "Login",
                "login_different": "Would you like to login with a different account now?",
                "credentials_required": "Client ID and Secret are required.",
                "auth_instructions": "1. Your browser will open to login to Spotify.\n2. After login, return here.\n\nNote: Large libraries take time. Please wait for the 'Ready' status.",
                "partial_sync_notice": "'{name}' is partially synced ({status}).\n\nWould you like to resume and download missing tracks?",
                "fully_synced_notice": "Selected playlists are already fully synced:\n- {list}",
                "select_playlist_notice": "Please select at least one playlist to download.",
                "confirm_download_lbl": "Confirm Download",
                "batch_complete_lbl": "Batch Complete",
                "open_output_dir_qn": "Open output directory?",
                "delete_files_qn": "Delete local files for '{name}' too?\n\nThis will permanently remove the folder:\n{path}",
                "delete_group_qn": "Delete '{name}'? Playlists will be moved out.",
                "refresh_complete_msg": "Successfully refreshed {count} library items.",
                "api_unavailable": "Spotify API is not available.",
                "invalid_url_msg": "Please provide a valid Spotify Playlist or Album link.",
                "merge_option_title": "Merge Option",
                "target_exists_confirm": "Target folder '{name}' already exists in Output Path. Merge contents?",
                "import_success_msg": "Successfully linked '{name}' to the library.",
                "import_error_title": "Import Error",
                "nothing_to_sync_msg": "Nothing to sync.",
                "batch_sync_complete_title": "Batch Sync Complete",
                "enter_url_notice": "Please enter a link first.",
                "download_success": "Downloaded {count} tracks successfully!",
                "download_error_title": "Download Error",
                "failed": "Failed",
                "failed_tag": "[FAILED]",
                "history_clear_confirm_qn": "Are you sure you want to clear your download history?",
                "open_download_folder_qn": "Download successful. Would you like to open the folder?",
                "history_cleared_msg": "History has been wiped.",
                "tip_download": "Add this link to the download queue",
                "tip_refresh_lib": "Check Spotify for new tracks in your library",
                "tip_import_folder": "Import an existing local music folder",
                "tip_add_profile": "Pick playlists directly from a Spotify profile",
                "tip_add_url": "Paste a Spotify link to track and download",
                "tip_new_group": "Create a new folder to organize your playlists",
                "tip_sync_all": "Download all new content for every playlist in your library",
                "tip_refresh_hist": "Reload the download history from disk",
                "tip_clear_hist": "Permanently delete all download records",
                "tip_browse_cookie": "Select a cookies.txt file to bypass YouTube age-restrictions",
                "tip_browse_output": "Choose the root folder where all music will be saved",
                "tip_save_settings": "Save all configuration changes to disk",
                "tip_restore_defaults": "Reset all settings to their initial factory values",
                "unknown_user": "Unknown User",
                "followers_lbl": "Followers: {count}",
                "create_subfolders": "Create Subfolders",
                "dl_selected_add": "Download selected and add to the library",
                "auth_title_dlg": "Spotify Authorization",
                "auth_needed_msg": "To access private playlists, you need to authorize this app.",
                "client_id_lbl": "Client ID:",
                "client_secret_lbl": "Client Secret:",
                "save_login": "Save & Login",
                "login_required": "Login Required",
                "login_failed": "Login failed or cancelled",
                "no_playlists_found": "No playlists found.",
                "starting": "Starting...",
                "preparing_library": "Preparing library...",
                "open_folder": "Open Folder",
                "move_to_group": "Move to Group",
                "choose_dest_group": "Choose destination group:",
                "hide": "Hide",
                "developed_by": "Developed with â¤ï¸ for music lovers",
                "powered_by": "Powered by Antigravity",
                "select_playlists_to_dl": "Select playlists to download",
                "synced_tag": "[Synced]",
                "checking_profile_sync": "Checking Profile Sync Status",
                "checking_progress": "Checking sync: {current}/{total}...",
                "open_browser_authorize": "Open Browser & Authorize",
                "use_saved_creds_qn": "Found saved Spotify API credentials in your settings.\n\nWould you like to use these existing credentials to login?",
                "use_saved_creds_options": "\nYes = Use Saved\nNo = Enter Manually\nCancel = Abort Login",
                "login_browser_opened": "A browser window has opened for Spotify login. Please authorize the application.\nOnce authorized, the setup will complete automatically.",
                "auth_success": "Successfully authenticated!"
            },
            "tr": {
                "library": "KÃ¼tÃ¼phane",
                "profile": "Profilim",
                "downloader": "HÄ±zlÄ± Ä°ndir",
                "history": "GeÃ§miÅŸ",
                "settings": "Ayarlar",
                "logs": "Loglar",
                "about": "HakkÄ±nda/SSS",
                "sync": "EÅŸitle",
                "sync_all": "TÃ¼mÃ¼nÃ¼ EÅŸitle",
                "status": "Durum",
                "tracks": "ÅŸarkÄ±",
                "last_sync": "Son EÅŸitleme",
                "spotify_updated": "Spotify GÃ¼ncellendi",
                "checking": "Kontrol ediliyor...",
                "synced": "Senkron",
                "new_songs": "Yeni ÅarkÄ±lar Mevcut",
                "interrupted": "Kesildi",
                "new": "Yeni",
                "details": "Detaylar",
                "save": "AyarlarÄ± Kaydet",
                "language": "Dil",
                "cookie_file": "Ã‡erez DosyasÄ±",
                "output_path": "Ä°ndirilecek KlasÃ¶r",
                "client_id": "Spotify Ä°stemci KimliÄŸi",
                "client_secret": "Spotify Ä°stemci Åifresi",
                "user_id": "VarsayÄ±lan Spotify KullanÄ±cÄ± Ä°smi",
                "log_level": "Log seviyesi",
                "refresh_status": "Yenile",
                "import_folder": "KlasÃ¶r Ä°Ã§e Aktar",
                "add_profile": "Profilden Ekle",
                "add_url": "Manuel link ekle",
                "new_group": "Yeni Grup",
                "browse": "GÃ¶z At",
                "download": "Ä°ndir",
                "clear_history": "GeÃ§miÅŸi Temizle",
                "no_history": "GeÃ§miÅŸ bulunamadÄ±.",
                "no_tracks_recorded": "ÅarkÄ± detayÄ± kaydedilmedi.",
                "error": "HATA",
                "aborted": "Ä°ptal Edildi",
                "login": "Spotify ile GiriÅŸ Yap",
                "logout": "Ã‡Ä±kÄ±ÅŸ Yap",
                "refresh": "Yenile",
                "search": "Ara",
                "my_playlists": "Ã‡alma Listelerim",
                "created_by_me": "Benim OluÅŸturduklarÄ±m",
                "followed_playlists": "Takip Edilen Listeler",
                "quick_download": "HÄ±zlÄ± Ä°ndir",
                "url_placeholder": "Spotify ÅarkÄ± veya Ã‡alma Listesi Linki Girin",
                "format": "Dosya tÃ¼rÃ¼",
                "ready": "HazÄ±r",
                "sync_library": "KÃ¼tÃ¼phane",
                "new_downloads_feed": "Yeni Ä°ndirme AkÄ±ÅŸÄ±",
                "collapse": "Daralt",
                "expand": "GeniÅŸlet",
                "technical_logs": "Teknik Hata LoglarÄ±",
                "followers": "TakipÃ§i",
                "not_logged_in": "GiriÅŸ yapÄ±lmadÄ±",
                "loading": "YÃ¼kleniyor...",
                "logout_confirm": "Spotify oturumunu kapatmak istediÄŸinizden emin misiniz?",
                "logout_success": "Spotify oturumu baÅŸarÄ±yla kapatÄ±ldÄ±.",
                "liked_songs": "BeÄŸenilen ÅarkÄ±lar",
                "profile_required": "Profil Gerekli",
                "authenticating": "Spotify ile kimlik doÄŸrulanÄ±yor...",
                "fetching_playlists": "Ã‡alma listeleri alÄ±nÄ±yor...",
                "empty_library": "KÃ¼tÃ¼phaneniz BoÅŸ",
                "library_info": "Takip ettiÄŸiniz Ã§alma listeleri burada gÃ¶rÃ¼nÃ¼r.",
                "quick_start": "ğŸ’¡ HÄ±zlÄ± BaÅŸlangÄ±Ã§:\n1. 'Profilim' sekmesine gidin\n2. Spotify ile giriÅŸ yapÄ±n\n3. Ã‡alma listelerini seÃ§ip kÃ¼tÃ¼phaneye ekleyin",
                "scanning_disk": "Disk Ã‡alma Listeleri Ä°Ã§in TaranÄ±yor",
                "checking_sync": "KÃ¼tÃ¼phane EÅŸitleme Durumu Kontrol Ediliyor",
                "never": "HiÃ§bir zaman",
                "empty_group": "(BoÅŸ Grup)",
                "rendering": "Ã–ÄŸeler oluÅŸturuluyor...",
                "refresh_metadata": "Metaveriler Yenileniyor",
                "new_group_prompt": "Grup AdÄ± Girin:",
                "rename_group": "Grubu Yeniden AdlandÄ±r",
                "new_name": "Yeni Ad:",
                "last_sync": "Son EÅŸitleme",
                "spotify_updated_lbl": "Spotify GÃ¼ncellendi",
                "new_songs_available": "Yeni ÅarkÄ±lar Mevcut",
                "discovered_on_disk": "Diskte Bulundu",
                "syncing": "EÅŸitleniyor",
                "spotipy_missing": "Spotipy KÃ¼tÃ¼phanesi Eksik",
                "remove": "KaldÄ±r",
                "remove_confirm": "'{name}' kÃ¼tÃ¼phaneden kaldÄ±rÄ±lsÄ±n mÄ±?",
                "sync_complete": "EÅŸitleme TamamlandÄ±",
                "download_complete": "Ä°ndirme TamamlandÄ±",
                "new": "Yeni",
                "could_not_load_readme": "SSS dÃ¶kÃ¼mantasyonu yÃ¼klenemedi.",
                "settings_saved": "Ayarlar baÅŸarÄ±yla kaydedildi!",
                "restart_notice": "Dil deÄŸiÅŸti. Tam etki iÃ§in lÃ¼tfen uygulamayÄ± yeniden baÅŸlatÄ±n.",
                "restore_defaults": "VarsayÄ±lanlarÄ± Geri YÃ¼kle",
                "restore_confirm": "TÃ¼m ayarlarÄ± sÄ±fÄ±rlamak istediÄŸinizden emin misiniz?\nBu iÅŸlem API anahtarlarÄ±nÄ±, yollarÄ± temizleyecek ve Spotify oturumunu kapatacaktÄ±r.",
                "reset_done": "Uygulama ayarlarÄ± varsayÄ±lana dÃ¶ndÃ¼rÃ¼ldÃ¼.",
                "success": "BaÅŸarÄ±lÄ±",
                "warning": "UyarÄ±lar",
                "warnings": "UyarÄ±lar",
                "info": "Bilgi",
                "error_lbl": "Hata",
                "confirmation": "Onay",
                "login_title": "GiriÅŸ",
                "login_different": "Åimdi farklÄ± bir hesapla giriÅŸ yapmak ister misiniz?",
                "credentials_required": "Ä°stemci KimliÄŸi (Client ID) ve Åifre (Secret) gereklidir.",
                "auth_instructions": "1. Spotify'a giriÅŸ yapmak iÃ§in tarayÄ±cÄ±nÄ±z aÃ§Ä±lacak.\n2. GiriÅŸ yaptÄ±ktan sonra buraya dÃ¶nÃ¼n.\n\nNot: BÃ¼yÃ¼k kÃ¼tÃ¼phanelerin yÃ¼klenmesi zaman alabilir. LÃ¼tfen 'HazÄ±r' durumunu bekleyin.",
                "partial_sync_notice": "'{name}' kÄ±smen eÅŸitlenmiÅŸ ({status}).\n\nDevam edip eksik parÃ§alarÄ± indirmek ister misiniz?",
                "fully_synced_notice": "SeÃ§ilen Ã§alma listeleri zaten tamamen eÅŸitlenmiÅŸ:\n- {list}",
                "select_playlist_notice": "LÃ¼tfen indirmek iÃ§in en az bir Ã§alma listesi seÃ§in.",
                "confirm_download_lbl": "Ä°ndirmeyi Onayla",
                "batch_complete_lbl": "Toplu Ä°ÅŸlem TamamlandÄ±",
                "open_output_dir_qn": "KayÄ±t klasÃ¶rÃ¼ aÃ§Ä±lsÄ±n mÄ±?",
                "delete_files_qn": "'{name}' iÃ§in yerel dosyalar da silinsin mi?\n\nBu iÅŸlem ÅŸu klasÃ¶rÃ¼ kalÄ±cÄ± olarak silecektir:\n{path}",
                "delete_group_qn": "'{name}' grubunu silmek istediÄŸinizden emin misiniz? Ä°Ã§indeki listeler dÄ±ÅŸarÄ± taÅŸÄ±nacaktÄ±r.",
                "refresh_complete_msg": "{count} kÃ¼tÃ¼phane Ã¶ÄŸesi baÅŸarÄ±yla yenilendi.",
                "api_unavailable": "Spotify API'sine ulaÅŸÄ±lamÄ±yor.",
                "invalid_url_msg": "LÃ¼tfen geÃ§erli bir Spotify Ã‡alma Listesi veya AlbÃ¼m linki girin.",
                "merge_option_title": "BirleÅŸtirme SeÃ§eneÄŸi",
                "target_exists_confirm": "'{name}' hedef klasÃ¶rÃ¼ zaten kayÄ±t yolunda mevcut. Ä°Ã§erikler birleÅŸtirilsin mi?",
                "import_success_msg": "'{name}' baÅŸarÄ±yla kÃ¼tÃ¼phaneye baÄŸlandÄ±.",
                "import_error_title": "Ä°Ã§e Aktarma HatasÄ±",
                "nothing_to_sync_msg": "EÅŸitlenecek bir ÅŸey yok.",
                "batch_sync_complete_title": "Toplu EÅŸitleme TamamlandÄ±",
                "enter_url_notice": "LÃ¼tfen Ã¶nce bir link girin.",
                "download_success": "{count} ÅŸarkÄ± baÅŸarÄ±yla indirildi!",
                "download_error_title": "Ä°ndirme HatasÄ±",
                "failed": "BaÅŸarÄ±sÄ±z",
                "failed_tag": "[BAÅARISIZ]",
                "history_clear_confirm_qn": "Ä°ndirme geÃ§miÅŸini temizlemek istediÄŸinizden emin misiniz?",
                "open_download_folder_qn": "Ä°ndirme baÅŸarÄ±lÄ±. KlasÃ¶rÃ¼ aÃ§mak ister misiniz?",
                "history_cleared_msg": "GeÃ§miÅŸ baÅŸarÄ±yla temizlendi.",
                "tip_download": "Bu linki indirme sÄ±rasÄ±na ekle",
                "tip_refresh_lib": "KÃ¼tÃ¼phanenizdeki yeni ÅŸarkÄ±lar iÃ§in Spotify'Ä± kontrol et",
                "tip_import_folder": "Mevcut bir yerel mÃ¼zik klasÃ¶rÃ¼nÃ¼ iÃ§e aktar",
                "tip_add_profile": "Ã‡alma listelerini doÄŸrudan bir Spotify profilinden seÃ§",
                "tip_add_url": "Takip etmek ve indirmek iÃ§in bir Spotify linki yapÄ±ÅŸtÄ±r",
                "tip_new_group": "Ã‡alma listelerinizi dÃ¼zenlemek iÃ§in yeni bir grup oluÅŸtur",
                "tip_sync_all": "KÃ¼tÃ¼phanenizdeki her Ã§alma listesi iÃ§in tÃ¼m yeni iÃ§erikleri indir",
                "tip_refresh_hist": "Ä°ndirme geÃ§miÅŸini diskten yeniden yÃ¼kle",
                "tip_clear_hist": "TÃ¼m indirme kayÄ±tlarÄ±nÄ± kalÄ±cÄ± olarak sil",
                "tip_browse_cookie": "YouTube yaÅŸ kÄ±sÄ±tlamalarÄ±nÄ± aÅŸmak iÃ§in bir cookies.txt dosyasÄ± seÃ§in",
                "tip_browse_output": "TÃ¼m mÃ¼ziklerin kaydedileceÄŸi ana klasÃ¶rÃ¼ seÃ§in",
                "tip_save_settings": "TÃ¼m yapÄ±landÄ±rma deÄŸiÅŸikliklerini diske kaydet",
                "tip_restore_defaults": "TÃ¼m ayarlarÄ± fabrika ayarlarÄ±na dÃ¶ndÃ¼r",
                "unknown_user": "Bilinmeyen KullanÄ±cÄ±",
                "followers_lbl": "TakipÃ§i: {count}",
                "create_subfolders": "Alt KlasÃ¶rler OluÅŸtur",
                "dl_selected_add": "SeÃ§ilenleri indir ve kÃ¼tÃ¼phaneye ekle",
                "auth_title_dlg": "Spotify Yetkilendirmesi",
                "auth_needed_msg": "Ã–zel Ã§alma listelerine eriÅŸmek iÃ§in bu uygulamayÄ± yetkilendirmeniz gerekir.",
                "client_id_lbl": "Ä°stemci KimliÄŸi (Client ID):",
                "client_secret_lbl": "Åifre (Secret):",
                "save_login": "Kaydet ve GiriÅŸ Yap",
                "login_required": "GiriÅŸ Gerekli",
                "login_failed": "GiriÅŸ baÅŸarÄ±sÄ±z veya iptal edildi",
                "no_playlists_found": "HiÃ§ Ã§alma listesi bulunamadÄ±.",
                "starting": "BaÅŸlatÄ±lÄ±yor...",
                "preparing_library": "KÃ¼tÃ¼phane hazÄ±rlanÄ±yor...",
                "open_folder": "KlasÃ¶rÃ¼ AÃ§",
                "move_to_group": "Gruba TaÅŸÄ±",
                "choose_dest_group": "Hedef grubu seÃ§in:",
                "hide": "Gizle",
                "developed_by": "MÃ¼zik severler iÃ§in â¤ï¸ ile geliÅŸtirildi",
                "powered_by": "Antigravity tarafÄ±ndan desteklenmektedir",
                "select_playlists_to_dl": "Ä°ndirmek iÃ§in Ã§alma listeleri seÃ§in",
                "synced_tag": "[Senkron]",
                "checking_profile_sync": "Profil EÅŸitleme Durumu Kontrol Ediliyor",
                "checking_progress": "EÅŸitleme kontrolÃ¼: {current}/{total}...",
                "open_browser_authorize": "TarayÄ±cÄ±yÄ± AÃ§ ve Yetkilendir",
                "use_saved_creds_qn": "AyarlarÄ±nÄ±zda kayÄ±tlÄ± Spotify API kimlik bilgileri bulundu.\n\nBu bilgileri giriÅŸ yapmak iÃ§in kullanmak ister misiniz?",
                "use_saved_creds_options": "\nEvet = KayÄ±tlÄ±yÄ± Kullan\nHayÄ±r = Manuel Gir\nÄ°ptal = VazgeÃ§",
                "login_browser_opened": "Spotify giriÅŸi iÃ§in tarayÄ±cÄ± aÃ§Ä±ldÄ±. LÃ¼tfen uygulamaya izin verin.\nOnayladÄ±ktan sonra kurulum otomatik olarak tamamlanacaktÄ±r.",
                "auth_success": "BaÅŸarÄ±yla kimlik doÄŸrulandÄ±!"
            }
        }

    def set_language(self, lang_code):
        if lang_code in self.translations:
            self.lang = lang_code
            self.logger.info(f"Language set to: {lang_code}")
        else:
            self.logger.warning(f"Language code '{lang_code}' not supported, falling back to English.")
            self.lang = "en"

    def t(self, key, default=None, **kwargs):
        """Translates a key based on current language."""
        text = self.translations.get(self.lang, {}).get(key, default or key)
        if kwargs:
            try:
                return text.format(**kwargs)
            except (KeyError, ValueError):
                pass
        return text

    def translate_error(self, error_str):
        """Translates common technical errors into human-readable localized strings."""
        if not error_str: return ""
        
        if self.lang == "tr":
            # Rate Limit Logic
            if "Extreme Rate Limit" in error_str or "429" in error_str:
                import re
                # Pattern: Spotdl will wait for 01:23:45
                match = re.search(r"wait for (\d{2}):(\d{2}):(\d{2})", error_str)
                if match:
                    h, m, s = match.groups()
                    h, m, s = int(h), int(m), int(s)
                    duration_parts = []
                    if h > 0: duration_parts.append(f"{h} saat")
                    if m > 0: duration_parts.append(f"{m} dakika")
                    if s > 0: duration_parts.append(f"{s} saniye")
                    
                    duration_str = " ve ".join(duration_parts)
                    return f"AÅŸÄ±rÄ± HÄ±z SÄ±nÄ±rÄ± (429). Spotify Ã§ok fazla istek aldÄ±ÄŸÄ±nÄ±zÄ± sÃ¶ylÃ¼yor. LÃ¼tfen {duration_str} kadar bekleyin, uygulama otomatik olarak devam edecektir."
                
                return "Spotify HÄ±z SÄ±nÄ±rÄ± (429). Ã‡ok fazla istek gÃ¶nderildi, uygulama bir sÃ¼re bekleyecek."

            if "No tracks found" in error_str:
                return "ÅarkÄ± bulunamadÄ±. LÃ¼tfen URL'yi kontrol edin."
            
            if "Spotify API Error" in error_str:
                return "Spotify API HatasÄ±. LÃ¼tfen internet baÄŸlantÄ±nÄ±zÄ± veya API anahtarlarÄ±nÄ±zÄ± kontrol edin."

        return error_str
